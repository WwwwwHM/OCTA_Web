# OCTA后端联调测试 - 快速验证清单

**日期：** 2026-01-28  
**测试者：** _____________  
**版本：** v1.0.0

---

## ✅ 预检查清单

在启动测试前，请确认以下项目：

### 环境准备

- [ ] Python 3.8+ 已安装
- [ ] 虚拟环境已激活（如使用）
- [ ] 依赖包已安装 (`pip install -r requirements.txt`)
- [ ] PyTorch 已正确安装（CPU或GPU版本）
- [ ] 端口8000未被占用

### 文件准备

- [ ] `test_data/test_image.png` 已准备（256x256灰度图）
- [ ] `models/weights/unet_octa.pth` 权重文件存在（可选）
- [ ] `config/config.py` 配置已检查
- [ ] 必要目录已创建（uploads, results, logs等）

### 模块完整性

- [ ] `core/weight_validator.py` 文件存在
- [ ] `core/model_loader.py` 文件存在
- [ ] `core/data_process.py` 文件存在
- [ ] `router/seg_router.py` 文件存在
- [ ] `router/weight_router.py` 文件存在
- [ ] `config/config.py` 文件存在

---

## 🚀 启动测试清单

### 步骤1: 启动后端服务

**命令：**
```bash
cd octa_backend
python main.py
```

**验证点：**
- [ ] 服务成功启动，无报错
- [ ] 日志显示：`Uvicorn running on http://0.0.0.0:8000`
- [ ] 访问 http://127.0.0.1:8000/ 返回 `{"status": "ok"}`
- [ ] 访问 http://127.0.0.1:8000/docs 显示API文档

**启动时间：** __________  
**启动日志：**
```
（粘贴关键日志）




```

---

### 步骤2: 健康检查测试

**命令：**
```bash
curl http://127.0.0.1:8000/
```

**预期响应：**
```json
{"status": "ok", "message": "OCTA后端服务运行中"}
```

**验证点：**
- [ ] 返回状态码 200
- [ ] 响应包含 `status: "ok"`

**实际响应：**
```
（粘贴实际响应）


```

---

### 步骤3: 权重上传测试（可选）

**接口：** `POST /api/v1/weight/upload`

**验证点：**
- [ ] 权重文件格式校验通过（.pth/.pt）
- [ ] 权重内容校验通过（state_dict完整）
- [ ] 返回有效的 `weight_id`
- [ ] 文件保存到 `static/uploads/weight/{weight_id}/`

**weight_id：** __________

**响应示例：**
```json
{
  "code": 200,
  "msg": "权重上传成功",
  "data": {
    "weight_id": "abc123",
    "filename": "unet_octa.pth",
    "size": 45678901
  }
}
```

---

### 步骤4: 分割预测测试（核心）

**接口：** `POST /api/v1/seg/predict`

**请求参数：**
- image_file: `test_data/test_image.png`
- weight_id: `official` 或上传的weight_id

**验证点：**
- [ ] 图像格式校验通过
- [ ] 权重路径解析成功
- [ ] 模型加载成功（显示设备类型）
- [ ] 图像预处理成功
- [ ] 模型推理成功
- [ ] 后处理成功
- [ ] 返回 `mask_base64` 字段

**推理设备：** __________ （cuda / cpu）  
**推理耗时：** __________ 秒

**响应示例：**
```json
{
  "code": 200,
  "msg": "推理成功",
  "data": {
    "mask_base64": "iVBORw0KGgo...",
    "device": "cuda",
    "infer_time": 0.8754,
    "weight_id": "official"
  }
}
```

---

### 步骤5: 掩码解码测试

**验证点：**
- [ ] Base64解码成功
- [ ] 掩码图像保存成功
- [ ] 图像尺寸与原图一致
- [ ] 像素值范围为 [0, 255]
- [ ] 数据类型为 uint8

**输出文件：** `test_results/api_result_mask.png`

**掩码信息：**
- 尺寸: __________
- 数组形状: __________
- 值范围: __________

---

### 步骤6: 本地对比测试（可选）

**验证点：**
- [ ] 本地推理成功
- [ ] API结果与本地结果对比
- [ ] 差异像素比例 < 5%

**差异比例：** ___________%

**对比结论：**
- [ ] 完全一致（差异<0.1%）
- [ ] 基本一致（差异<5%）
- [ ] 存在差异（差异>5%）

---

### 步骤7: 可视化验证

**验证点：**
- [ ] 对比图生成成功（`test_results/comparison.png`）
- [ ] 原图清晰可见
- [ ] 掩码正确显示
- [ ] 血管分割效果合理

**视觉评估：**
- [ ] 血管边缘清晰
- [ ] 细小血管保留良好
- [ ] 无明显噪声
- [ ] 无明显遗漏

---

## 📊 完整测试脚本

**命令：**
```bash
python test_seg_api.py
```

**验证点：**
- [ ] 步骤0: 健康检查通过
- [ ] 步骤1: 权重上传成功（或跳过）
- [ ] 步骤2: 分割预测成功
- [ ] 步骤3: 掩码解码成功
- [ ] 步骤4: 本地对比完成（或跳过）
- [ ] 步骤5: 可视化生成成功
- [ ] 最终显示"✅ 联调测试完成"

**总耗时：** __________ 秒

**脚本输出：**
```
（粘贴关键输出）




```

---

## 🐛 问题记录

### 发现的问题

**问题1：**
- 描述: __________
- 错误信息: __________
- 解决方案: __________
- 状态: □ 已解决 □ 待解决

**问题2：**
- 描述: __________
- 错误信息: __________
- 解决方案: __________
- 状态: □ 已解决 □ 待解决

---

## 📈 性能指标

### 推理性能

| 指标 | 预期值 | 实际值 | 是否达标 |
|-----|-------|-------|---------|
| 模型加载时间 | <3秒 | ____秒 | □ 是 □ 否 |
| 单张推理时间（CPU） | 2-5秒 | ____秒 | □ 是 □ 否 |
| 单张推理时间（GPU） | 0.1-0.5秒 | ____秒 | □ 是 □ 否 |
| 完整请求时间 | <10秒 | ____秒 | □ 是 □ 否 |

### API响应性能

| 接口 | 响应时间 | 状态码 | 是否正常 |
|-----|---------|-------|---------|
| GET / | ____ms | ____ | □ 是 □ 否 |
| POST /api/v1/weight/upload | ____ms | ____ | □ 是 □ 否 |
| POST /api/v1/seg/predict | ____ms | ____ | □ 是 □ 否 |

---

## 📝 测试总结

### 通过的测试项

- [ ] 后端服务启动正常
- [ ] 健康检查接口正常
- [ ] 权重上传接口正常
- [ ] 分割预测接口正常
- [ ] 掩码解码功能正常
- [ ] 本地对比功能正常
- [ ] 可视化生成功能正常
- [ ] 性能指标达标
- [ ] 无严重错误或警告

**通过率：** ____/9 ≈ ____%

### 整体评估

- [ ] **优秀** - 所有测试通过，性能优异
- [ ] **良好** - 主要功能正常，个别小问题
- [ ] **合格** - 核心功能可用，有待改进
- [ ] **不合格** - 关键功能失败，需重大修复

### 改进建议

1. __________
2. __________
3. __________

---

## ✅ 最终确认

**测试者签名：** __________  
**测试日期：** __________  
**测试结果：** □ 通过 □ 有问题  

**是否可用于毕设答辩演示：** □ 是 □ 否

---

## 📎 附件

- [ ] 测试日志文件 `logs/octa_backend.log`
- [ ] 测试结果截图
- [ ] 性能测试报告
- [ ] 问题报告文档

---

**备注：**
```
（其他说明）


```
