# 历史记录功能 - 快速开始指南

**目的**: 快速验证和使用OCTA历史记录页面  
**预计时间**: 5分钟  
**难度**: ⭐ (非常简单)

---

## 第一步：启动后端服务 (2分钟)

### Windows用户 - 最简单方式

```bash
# 进入后端目录
cd octa_backend

# 双击运行启动脚本
start_server.bat
```

**或者手动启动**:

```bash
# 激活虚拟环境
..\octa_env\Scripts\activate

# 启动服务
python main.py
```

### Linux/Mac用户

```bash
cd octa_backend

# 激活虚拟环境
source ../octa_env/bin/activate

# 启动服务
python main.py
```

**成功标志**：看到这样的输出
```
INFO:     Uvicorn running on http://127.0.0.1:8000
```

---

## 第二步：启动前端服务 (2分钟)

### 新终端窗口中执行

```bash
# 进入前端目录
cd octa_frontend

# 启动开发服务器
npm run dev
```

**成功标志**：看到这样的输出
```
  VITE v5.0.0  ready in 200 ms

  ➜  Local:   http://127.0.0.1:5173/
```

---

## 第三步：访问历史记录页面 (1分钟)

### 打开浏览器

1. **访问首页**: http://127.0.0.1:5173
2. **点击导航**: 在顶部看到 "History" 链接，点击它
3. **或直接访问**: http://127.0.0.1:5173/history

**应该看到**:
- ✅ 蓝色卡片容器
- ✅ 统计信息卡片（总数、模型数）
- ✅ 表格（如果有历史记录则显示，否则显示空状态）
- ✅ 刷新按钮

---

## 快速测试 (无需上传新图像)

### 方式1：查看现有记录

如果数据库中已有分割记录，会自动显示：

```
序号 | 文件名              | 时间     | 模型 | 操作
-----|-------------------|--------|------|--------
1    | a1b2c3d4...      | 01-12  | unet | [预览] [下载] [删除]
2    | b2c3d4e5...      | 01-11  | fcn  | [预览] [下载] [删除]
```

### 测试各个功能

#### 📸 测试预览
1. 点击任意记录的 "原图预览"
2. 应该看到原始上传的图像
3. 可以放大、缩小、拖拽
4. 点击外部区域关闭

#### 🖼️ 测试结果预览
1. 点击同一行的 "结果预览"
2. 应该看到分割后的灰度图
3. 可以放大、缩小
4. 点击外部区域关闭

#### ⬇️ 测试下载
1. 点击 "下载" 按钮
2. 浏览器开始下载 `xxx_segmented.png` 文件
3. 查看下载文件夹，文件应该在那里

#### 🗑️ 测试删除
1. 点击 "删除" 按钮
2. 弹出确认对话框："确定要删除这条分割记录吗？"
3. 点击 "确定删除"
4. 记录从表格中消失
5. 统计数字更新（总数 -1）

---

## 方式2：上传新图像进行完整测试

### 步骤1：上传图像

1. 访问 http://127.0.0.1:5173 (首页)
2. 上传一张 PNG 格式的图像
3. 选择模型类型（U-Net 或 FCN）
4. 点击分割
5. 等待完成

### 步骤2：查看历史记录

1. 点击 "History" 导航链接
2. 应该看到刚上传的图像
3. 尝试预览、下载、删除等操作

---

## 🔍 验证清单

完成以下项后，说明功能正常：

- [ ] 页面加载无错误
- [ ] 表格显示数据（或空状态提示）
- [ ] 统计数字显示
- [ ] 刷新按钮可以点击
- [ ] 预览功能可用（原图和结果都能预览）
- [ ] 下载功能可用（文件成功下载）
- [ ] 删除功能可用（成功删除后列表更新）
- [ ] 响应式设计生效（缩小窗口看效果）

---

## ⚠️ 常见问题

### Q: 访问 /history 显示空白页？

**可能原因**:
1. HistoryView.vue 组件未加载
2. 后端服务未启动
3. CORS配置错误

**解决方案**:
1. 检查浏览器控制台（F12 → Console）是否有错误
2. 确认后端运行在 http://127.0.0.1:8000
3. 刷新浏览器

### Q: 表格显示，但图像预览失败？

**可能原因**: 图像文件丢失或后端图像接口异常

**解决方案**:
1. 检查 octa_backend/uploads/ 目录是否有文件
2. 查看浏览器Network标签，/images/{filename} 请求是否返回404
3. 检查后端日志

### Q: 删除按钮点击后没反应？

**可能原因**: DELETE /history/{id} 接口异常

**解决方案**:
1. 查看浏览器控制台是否有错误
2. 检查后端是否收到DELETE请求（查看后端日志）
3. 确认数据库octa.db存在且可写

### Q: 下载的文件是空的或损坏？

**可能原因**: 分割结果文件损坏或权限问题

**解决方案**:
1. 查看 octa_backend/results/ 目录
2. 确认文件存在且大小正常（> 0 bytes）
3. 手动下载测试：访问 http://127.0.0.1:8000/results/{filename}

---

## 🎯 期望效果

### 理想情况

```
┌─────────────────────────────────┐
│  分割历史记录  [刷新按钮]        │
├─────────────────────────────────┤
│  总数: 5   U-Net: 3   FCN: 2   │
├─────────────────────────────────┤
│ 序号│文件名    │时间    │模型│操作 │
├─────────────────────────────────┤
│  1  │abc123   │01-12  │unet│▼▼▼ │
│  2  │def456   │01-11  │fcn │▼▼▼ │
│  3  │ghi789   │01-10  │unet│▼▼▼ │
└─────────────────────────────────┘

操作按钮：
- [👁️ 原图预览] - 显示上传的原图
- [👁️ 结果预览] - 显示分割结果  
- [⬇️ 下载] - 下载PNG文件
- [🗑️ 删除] - 删除记录
```

---

## 📋 下一步操作

### 如果一切正常

1. **测试其他功能**
   - 上传不同格式的图像（尝试会失败，验证验证功能）
   - 上传大图像（验证处理速度）
   - 快速连续上传（验证并发处理）

2. **扩展功能**（可选）
   - 添加分页显示（每页20条）
   - 添加日期过滤器
   - 添加模型类型过滤器
   - 添加批量删除功能

3. **部署到服务器**
   - 使用gunicorn替代uvicorn（后端生产环境）
   - 使用Nginx作为反向代理
   - 配置HTTPS和SSL证书
   - 设置自动备份数据库

### 如果遇到问题

1. 查看详细的故障排查指南: [TROUBLESHOOTING.md](octa_backend/TROUBLESHOOTING.md)
2. 查看完整的功能说明: [HISTORY_VIEW_GUIDE.md](octa_frontend/HISTORY_VIEW_GUIDE.md)
3. 查看验证清单: [HISTORY_FEATURE_CHECKLIST.md](HISTORY_FEATURE_CHECKLIST.md)

---

## 📞 获取帮助

如果还有问题：

1. **查看终端日志**
   - 后端日志：看main.py运行的终端窗口
   - 前端日志：查看浏览器的开发者工具（F12）

2. **检查API是否工作**
   - 访问 http://127.0.0.1:8000/history/
   - 应该返回JSON数组：`[{...}, {...}]`

3. **重启服务**
   - 关闭前后端服务
   - 按步骤重新启动

---

## 🎉 成功标志

当你看到以下情况时，说明功能完全正常：

✅ 历史记录表格显示正确  
✅ 统计数字准确  
✅ 图像预览可以放大缩小  
✅ 下载文件到本地  
✅ 删除记录后列表更新  
✅ 刷新按钮重新加载数据  
✅ 页面响应式布局正确  

---

**提示**: 这是一个快速验证指南。更多详细信息请参考完整文档。

**所需时间**: 大约5分钟  
**难度**: ⭐ 非常简单  
**准备好了吗?** 让我们开始吧！

