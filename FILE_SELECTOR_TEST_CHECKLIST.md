# 文件选择器功能测试清单

## ✅ 测试执行记录

**测试日期:** 2026-01-20  
**测试环境:**
- 后端: FastAPI + Python
- 前端: Vue 3 + Element Plus
- 数据库: SQLite

---

## 📋 测试项目

### A. 后端API测试

#### A1. 文件列表API (`GET /file/list`)

- [ ] **测试1.1**: 获取图像文件列表
  ```bash
  curl "http://127.0.0.1:8000/file/list?file_type=image"
  ```
  **期望结果**: 返回所有 `file_type='image'` 的文件列表

- [ ] **测试1.2**: 获取数据集文件列表
  ```bash
  curl "http://127.0.0.1:8000/file/list?file_type=dataset"
  ```
  **期望结果**: 返回所有 `file_type='dataset'` 的文件列表

- [ ] **测试1.3**: 空列表场景
  - 清空数据库中所有图像记录
  - 调用API
  - **期望结果**: 返回空数组 `{"code":200, "data":[]}`

- [ ] **测试1.4**: 无效参数场景
  ```bash
  curl "http://127.0.0.1:8000/file/list?file_type=invalid"
  ```
  **期望结果**: 返回空数组或错误提示

#### A2. 文件预览API (`GET /file/preview/{file_id}`)

- [ ] **测试2.1**: 预览PNG图像
  - 上传一张PNG图像
  - 记录文件ID
  - 调用 `/file/preview/{file_id}`
  - **期望结果**: 返回Base64编码的预览数据

- [ ] **测试2.2**: 预览JPG图像
  - 上传一张JPG图像
  - 调用预览API
  - **期望结果**: 返回正确的MIME类型 `image/jpeg`

- [ ] **测试2.3**: 数据集文件预览(应拒绝)
  - 上传一个数据集文件(ZIP)
  - 调用预览API
  - **期望结果**: 返回 `400` 错误 "仅支持图片预览"

- [ ] **测试2.4**: 不存在的文件ID
  ```bash
  curl "http://127.0.0.1:8000/file/preview/99999"
  ```
  **期望结果**: 返回 `404` 错误 "文件不存在"

- [ ] **测试2.5**: 文件已被删除
  - 上传图像并记录ID
  - 手动删除磁盘上的文件
  - 调用预览API
  - **期望结果**: 返回 `404` 错误 "文件已被删除"

#### A3. 历史文件训练API (`POST /train/start-with-file/{file_id}`)

- [ ] **测试3.1**: 使用历史数据集训练
  ```bash
  curl -X POST "http://127.0.0.1:8000/train/start-with-file/1" \
       -F "model_arch=unet" \
       -F "epochs=5"
  ```
  **期望结果**: 成功触发训练,返回训练结果

- [ ] **测试3.2**: 使用图像文件训练(应拒绝)
  - 使用图像文件ID
  - 调用训练API
  - **期望结果**: 返回 `400` 错误 "只能使用数据集文件"

- [ ] **测试3.3**: 不存在的数据集ID
  ```bash
  curl -X POST "http://127.0.0.1:8000/train/start-with-file/99999"
  ```
  **期望结果**: 返回 `404` 错误 "文件不存在"

- [ ] **测试3.4**: RS-Unet3+模型训练
  ```bash
  curl -X POST "http://127.0.0.1:8000/train/start-with-file/1" \
       -F "model_arch=rs_unet3_plus" \
       -F "epochs=10" \
       -F "attention_weight=0.8"
  ```
  **期望结果**: 使用RS-Unet3+模型成功训练

---

### B. 前端组件测试 (FileSelector.vue)

#### B1. 基础功能

- [ ] **测试B1.1**: 组件正常渲染
  - 打开HomeView页面
  - 检查标签页是否显示 "上传新文件" 和 "选择已上传文件"

- [ ] **测试B1.2**: 标签页切换
  - 点击 "选择已上传文件" 标签
  - **期望结果**: 自动加载文件列表

- [ ] **测试B1.3**: 空列表提示
  - 数据库中无历史文件
  - 切换到 "选择已上传文件"
  - **期望结果**: 显示 "暂无已上传的文件" 提示

#### B2. 文件列表功能

- [ ] **测试B2.1**: 显示文件列表
  - 上传3张图像
  - 切换到选择标签
  - **期望结果**: 表格显示3条记录

- [ ] **测试B2.2**: 文件大小格式化
  - 检查表格中的文件大小列
  - **期望结果**: 显示为 "2.5 MB" 格式

- [ ] **测试B2.3**: 上传时间排序
  - 点击 "上传时间" 列头
  - **期望结果**: 列表按时间排序

- [ ] **测试B2.4**: 加载状态
  - 模拟网络延迟
  - 切换到选择标签
  - **期望结果**: 显示骨架屏加载动画

#### B3. 图像预览功能 (仅HomeView)

- [ ] **测试B3.1**: 选择并预览图像
  - 点击某张历史图像的 "选择" 按钮
  - **期望结果**: 
    1. 显示成功提示
    2. 图像预览区显示Base64图像
    3. 显示文件详情

- [ ] **测试B3.2**: 预览加载失败
  - 选择一个磁盘上已删除的图像
  - **期望结果**: 显示错误提示

- [ ] **测试B3.3**: 预览URL格式
  - 选择图像后
  - 检查img元素的src属性
  - **期望结果**: src以 `data:image/png;base64,` 开头

#### B4. 数据集选择功能 (仅TrainView)

- [ ] **测试B4.1**: 选择数据集
  - 切换到 "选择已上传数据集"
  - 点击某个数据集的 "选择" 按钮
  - **期望结果**: 
    1. 按钮文本变为 "已选择"
    2. 按钮变为绿色
    3. 显示选择提示框

- [ ] **测试B4.2**: 切换选择
  - 选择数据集A
  - 再选择数据集B
  - **期望结果**: 仅B被标记为已选择

---

### C. 集成测试

#### C1. 分割页面完整流程

- [ ] **测试C1.1**: 使用历史图像分割
  1. 打开分割页面
  2. 切换到 "选择已上传文件"
  3. 选择一张历史图像
  4. 选择模型 "U-Net"
  5. 点击 "开始图像分割"
  6. **期望结果**: 成功显示分割结果

- [ ] **测试C1.2**: 上传新图像分割
  1. 切换到 "上传新文件"
  2. 拖拽上传新图像
  3. 选择模型
  4. 点击分割
  5. **期望结果**: 成功分割

- [ ] **测试C1.3**: 模式切换互斥
  1. 选择历史图像
  2. 切换到 "上传新文件"
  3. 上传新图像
  4. **期望结果**: 历史选择被清除,使用新上传的图像

#### C2. 训练页面完整流程

- [ ] **测试C2.1**: 使用历史数据集训练
  1. 打开训练页面
  2. 选择模型架构 "U-Net"
  3. 切换到 "选择已上传数据集"
  4. 选择历史数据集
  5. 配置训练参数
  6. 点击 "开始训练"
  7. **期望结果**: 成功触发训练

- [ ] **测试C2.2**: 上传新数据集训练
  1. 切换到 "上传新数据集"
  2. 上传ZIP文件
  3. 选择模型
  4. 点击训练
  5. **期望结果**: 成功训练

- [ ] **测试C2.3**: RS-Unet3+高级训练
  1. 选择 "RS-Unet3+" 模型
  2. 选择历史数据集
  3. 配置高级参数(attention_weight等)
  4. 开始训练
  5. **期望结果**: 使用正确参数训练

---

### D. 异常场景测试

#### D1. 网络错误

- [ ] **测试D1.1**: API超时
  - 停止后端服务
  - 尝试加载文件列表
  - **期望结果**: 显示网络错误提示

- [ ] **测试D1.2**: 预览加载超时
  - 模拟慢速网络
  - 选择大图像
  - **期望结果**: 显示加载指示器,最终超时提示

#### D2. 数据一致性

- [ ] **测试D2.1**: 数据库记录存在但文件已删除
  - 数据库中保留文件记录
  - 手动删除磁盘文件
  - 选择该文件
  - **期望结果**: 后端返回404错误,前端显示错误提示

- [ ] **测试D2.2**: 文件类型不匹配
  - 修改数据库将图像标记为dataset
  - 尝试在分割页面选择
  - **期望结果**: 列表中不显示该文件

#### D3. 并发场景

- [ ] **测试D3.1**: 同时选择多个文件
  - 快速连续点击多个 "选择" 按钮
  - **期望结果**: 仅最后一个被选中

- [ ] **测试D3.2**: 训练中切换数据集
  - 开始训练
  - 训练进行中切换到其他数据集
  - **期望结果**: 训练按钮禁用,无法切换

---

### E. 性能测试

#### E1. 大文件处理

- [ ] **测试E1.1**: 10MB图像预览
  - 上传10MB PNG图像
  - 预览加载
  - **期望时间**: < 3秒

- [ ] **测试E1.2**: 50MB数据集选择
  - 上传50MB数据集
  - 选择并训练
  - **期望时间**: < 10秒

#### E2. 大量文件

- [ ] **测试E2.1**: 100+文件列表
  - 上传100张图像
  - 加载列表
  - **期望时间**: < 2秒
  - **期望结果**: 表格流畅滚动

---

### F. 兼容性测试

#### F1. 浏览器兼容性

- [ ] **Chrome** (推荐)
- [ ] **Firefox**
- [ ] **Edge**
- [ ] **Safari** (Mac)

#### F2. 文件格式兼容性

- [ ] **PNG** 图像
- [ ] **JPG** 图像
- [ ] **JPEG** 图像
- [ ] **ZIP** 数据集
- [ ] **RAR** 数据集
- [ ] **7Z** 数据集

---

## 📝 测试结果记录

### 问题记录

| 编号 | 描述 | 严重程度 | 状态 |
|------|------|----------|------|
| - | - | - | - |

### 测试统计

- **通过**: ___ / ___
- **失败**: ___ / ___
- **阻塞**: ___ / ___
- **跳过**: ___ / ___

---

## ✅ 发布检查清单

在部署到生产环境前,确保:

- [ ] 所有核心测试用例通过
- [ ] 无高优先级问题
- [ ] 性能指标达标
- [ ] 代码已通过review
- [ ] 数据库迁移脚本就绪
- [ ] 用户文档已更新
- [ ] 备份策略已确认

---

**测试负责人:** _____________  
**审核人:** _____________  
**发布日期:** _____________
